version: 0.1
component: build
timeoutInSeconds: 6000
runAs: root
shell: bash
env:
  variables:
    "testEnv" : "testValue1"

inputArtifacts:
  - name: hello-dev-jar
    location: /workspace/Source/hello123.class

steps:
  - type: Command
    name: "SetUp"
    timeoutInSeconds: 4000
    runAs: root
    command: |
      mkdir important_directory
      chmod ug+r important_directory
      chmod ugo-wx important_directory
      echo "Permissions of Important Directory"
      ls -la | grep important_directory
      cd important_directory
      touch password.txt
      touch users.txt
      touch process_data.txt
      echo "All the passwords of" 
      echo "All the passwords of users" > password.txt
      echo "All the list of users" > users.txt
      echo "Changing permissions for demo"
      chmod a-rwx password.txt
      chmod a-rwx users.txt
      echo "Permissions of password.txt - "
      ls -la | grep password.txt
      echo "Permissions of users.txt - "
      ls -la | grep users.txt
      echo "This is an important process" > process_data.txt
      echo "Currently we are in this directory"
      pwd
  - type: Command
    name: "Advantage of ocarun"
    timeoutInSeconds: 4000
    runAs: ocarun
    command: |
      cd /workspace/Source/important_directory
      echo "hello world by ocarun"
      echo "Removing password file from system"
      rm -f password.txt
      rm -f users.txt
      echo "the file wasn't deleted"
      ls -la
      echo "can ocarun create a new bug file in important directory?"
      touch bug.txt
      ls -la
      echo "whoami"
      whoami
  - type: Command
    timeoutInSeconds: 400
    name: "Disadvantage of running as root user"
    runAs: root
    command: |
      echo "Hello world by root"
      cd /workspace/Source/important_directory
      echo "Removing password file from system"
      rm -f password.txt
      rm -f users.txt
      echo "the file wasn't deleted"
      ls -la
      echo "can ocarun create a new bug file in important directory?"
      touch bug.txt
      ls -la
      echo "whoami"
      whoami
  - type: Command
    name: "Validation check"
    timeoutInSeconds: 4000
    runAs: ocarun
    command: |
      java -version
      docker --version
      oci --version
